<template>
    <div class="slds-form-element__control">
        <div class="slds-input-has-icon slds-input-has-icon_right">
            <input id={inputId} class="slds-input" type="text" placeholder={placeholder} value={inputValue}
                oninput={handleInput} onfocus={openDrawer} disabled={disabled} />
            <template if:true={isLoading}>
                <div class="slds-input__icon-group slds-input__icon-group_right">
                    <lightning-spinner size="x-small" variant="brand"></lightning-spinner>
                </div>
            </template>
            <template if:false={isLoading}>
                <span class="slds-input__icon slds-input__icon_right">
                    <lightning-icon icon-name="utility:search" size="x-small"></lightning-icon>
                </span>
            </template>
        </div>

        <!-- Drawer -->
        <template if:true={showDrawer}>
            <div class="lookup-drawer">
                <ul class="slds-listbox slds-listbox_vertical">
                    <!-- Freitext -->
                    <li class="slds-listbox__item" data-index="0" onclick={handleOptionClick}>
                        <div class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small">
                            <span class="slds-media__figure slds-listbox__option-icon">
                                <lightning-icon icon-name="utility:quote" size="x-small"></lightning-icon>
                            </span>
                            <span class="slds-media__body">
                                <span class="slds-truncate"
                                    title={freeTextOption.primary}>{freeTextOption.primary}</span>&nbsp;
                                <span class="slds-truncate slds-text-color_weak">Freitext</span>
                            </span>
                        </div>
                    </li>

                    <!-- Treffer -->
                    <template if:true={hasResults}>
                        <template for:each={recordOptions} for:item="option">
                            <li key={option.key} class="slds-listbox__item" data-index={option.index}
                                data-id={option.recordId} onclick={handleOptionClick}>
                                <div
                                    class="slds-media slds-listbox__option slds-listbox__option_entity slds-media_small">
                                    <span class="slds-media__figure slds-listbox__option-icon">
                                        <lightning-icon icon-name="standard:contact" size="x-small"></lightning-icon>
                                    </span>
                                    <span class="slds-media__body">
                                        <span class="slds-truncate" title={option.primary}>{option.primary}</span>
                                        <template if:true={option.secondary}>
                                            <span class="slds-truncate slds-text-color_weak"
                                                title={option.secondary}>{option.secondary}</span>
                                        </template>
                                    </span>
                                </div>
                            </li>
                        </template>
                    </template>

                    <!-- Keine Treffer -->
                    <template if:false={hasResults}>
                        <li
                            class="slds-listbox__item slds-p-vertical_small slds-p-horizontal_small slds-text-color_weak">
                            Keine Treffer
                        </li>
                    </template>
                </ul>
            </div>
        </template>

        <!-- Auswahl als Pill -->
        <template if:true={hasSelection}>
            <div class="slds-m-top_x-small">
                <span class="slds-pill" title={selectionLabel}>
                    <span class="slds-pill__label slds-truncate" title={selectionLabel}>{selectionLabel}</span>
                    <button class="slds-button slds-button_icon slds-pill__remove" title="Auswahl löschen"
                        onclick={clearSelection}>
                        <lightning-icon icon-name="utility:close" size="x-small"></lightning-icon>
                        <span class="slds-assistive-text">Auswahl löschen</span>
                    </button>
                </span>
            </div>
        </template>
    </div>
</template>